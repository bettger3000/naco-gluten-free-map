<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ³ãƒ—ãƒ«PINãƒ†ã‚¹ãƒˆ</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            background: #ff6b9d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ã‚·ãƒ³ãƒ—ãƒ«PINãƒ†ã‚¹ãƒˆ</h1>
    
    <button onclick="testSimpleQuery()">1. ã‚·ãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒªãƒ†ã‚¹ãƒˆ</button>
    <button onclick="testPinQuery()">2. PINèªè¨¼ã‚¯ã‚¨ãƒªãƒ†ã‚¹ãƒˆ</button>
    <button onclick="testWithTimeout()">3. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ããƒ†ã‚¹ãƒˆ</button>
    
    <div id="result" class="result">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>

    <script>
        const SUPABASE_URL = 'https://hxrmsjfvgctoaxpbukvo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh4cm1zamZ2Z2N0b2F4cGJ1a3ZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5MTI3NTAsImV4cCI6MjA3MDQ4ODc1MH0.tM1vDVVhYhh7OHlA1BTj071BfsIzeBG_HatijjtxwLw';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const resultDiv = document.getElementById('result');

        async function testSimpleQuery() {
            resultDiv.innerHTML = 'ğŸ” ã‚·ãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒªå®Ÿè¡Œä¸­...';
            console.log('ğŸ” ã‚·ãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒªé–‹å§‹');
            
            try {
                const startTime = Date.now();
                
                const { data, error } = await supabase
                    .from('user_profiles')
                    .select('email')
                    .limit(1);
                
                const duration = Date.now() - startTime;
                
                console.log('ã‚¯ã‚¨ãƒªçµæœ:', { data, error, duration });
                
                if (error) {
                    resultDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${JSON.stringify(error)}<br>æ‰€è¦æ™‚é–“: ${duration}ms`;
                } else {
                    resultDiv.innerHTML = `âœ… æˆåŠŸï¼<br>ãƒ‡ãƒ¼ã‚¿: ${JSON.stringify(data)}<br>æ‰€è¦æ™‚é–“: ${duration}ms`;
                }
            } catch (e) {
                console.error('ä¾‹å¤–:', e);
                resultDiv.innerHTML = `âŒ ä¾‹å¤–ã‚¨ãƒ©ãƒ¼: ${e.message}`;
            }
        }

        async function testPinQuery() {
            resultDiv.innerHTML = 'ğŸ” PINèªè¨¼ã‚¯ã‚¨ãƒªå®Ÿè¡Œä¸­...';
            console.log('ğŸ” PINèªè¨¼ã‚¯ã‚¨ãƒªé–‹å§‹');
            
            const email = 'bettger1000@gmail.com';
            const pin = '1234';
            
            try {
                const startTime = Date.now();
                
                // æ®µéšçš„ã«ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œ
                console.log('Step 1: email ã®ã¿ã§ã‚¯ã‚¨ãƒª');
                const { data: data1, error: error1 } = await supabase
                    .from('user_profiles')
                    .select('email, pin, is_active')
                    .eq('email', email.toLowerCase());
                
                console.log('Step 1 çµæœ:', { data1, error1 });
                
                if (!error1 && data1) {
                    console.log('Step 2: PIN ã‚’è¿½åŠ ã—ã¦ã‚¯ã‚¨ãƒª');
                    const { data: data2, error: error2 } = await supabase
                        .from('user_profiles')
                        .select('email, nickname, is_active')
                        .eq('email', email.toLowerCase())
                        .eq('pin', pin);
                    
                    console.log('Step 2 çµæœ:', { data2, error2 });
                    
                    if (!error2 && data2) {
                        console.log('Step 3: single() ã‚’è¿½åŠ ');
                        const { data: data3, error: error3 } = await supabase
                            .from('user_profiles')
                            .select('email, nickname, is_active')
                            .eq('email', email.toLowerCase())
                            .eq('pin', pin)
                            .single();
                        
                        const duration = Date.now() - startTime;
                        
                        console.log('Step 3 çµæœ:', { data3, error3 });
                        
                        if (error3) {
                            resultDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${JSON.stringify(error3)}<br>æ‰€è¦æ™‚é–“: ${duration}ms`;
                        } else {
                            resultDiv.innerHTML = `âœ… PINèªè¨¼æˆåŠŸï¼<br>ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${data3.email}<br>æ‰€è¦æ™‚é–“: ${duration}ms`;
                        }
                    }
                }
            } catch (e) {
                console.error('ä¾‹å¤–:', e);
                resultDiv.innerHTML = `âŒ ä¾‹å¤–ã‚¨ãƒ©ãƒ¼: ${e.message}`;
            }
        }

        async function testWithTimeout() {
            resultDiv.innerHTML = 'ğŸ” ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
            console.log('ğŸ” ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ããƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                const queryPromise = supabase
                    .from('user_profiles')
                    .select('email, nickname, is_active')
                    .eq('email', 'bettger1000@gmail.com')
                    .eq('pin', '1234')
                    .single();
                
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ5ç§’ï¼‰')), 5000)
                );
                
                const { data, error } = await Promise.race([queryPromise, timeoutPromise]);
                
                if (error) {
                    resultDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                } else {
                    resultDiv.innerHTML = `âœ… æˆåŠŸï¼<br>ãƒ‡ãƒ¼ã‚¿: ${JSON.stringify(data)}`;
                }
            } catch (e) {
                console.error('ä¾‹å¤–:', e);
                resultDiv.innerHTML = `âŒ ${e.message}`;
            }
        }
    </script>
</body>
</html>