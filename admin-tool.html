<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ãƒãƒƒãƒ— ç®¡ç†ãƒ„ãƒ¼ãƒ«</title>
    <style>
        :root {
            --primary: #ff6b9d;
            --primary-dark: #e55a8a;
            --secondary: #40e0d0;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #1a1a1a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-secondary);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-xl);
        }

        .header {
            background: var(--primary);
            color: white;
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-xl);
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: var(--space-sm);
        }

        .header p {
            opacity: 0.9;
        }

        .section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-lg);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            font-size: 1.5rem;
            margin-bottom: var(--space-lg);
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: var(--space-sm);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: 600;
            color: var(--text-primary);
        }

        input, select, textarea {
            width: 100%;
            padding: var(--space-md);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .btn {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: var(--space-sm);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        .store-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            padding: var(--space-md);
        }

        .store-item {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            border-left: 4px solid var(--primary);
        }

        .store-item h4 {
            margin-bottom: var(--space-sm);
            color: var(--primary);
        }

        .store-item p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-sm);
        }

        .store-actions {
            text-align: right;
        }

        .alert {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
        }

        .alert-success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
        }

        .alert-warning {
            background: #fffbeb;
            border: 1px solid #fed7aa;
            color: #92400e;
        }

        .download-section {
            text-align: center;
            padding: var(--space-xl);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: var(--radius-lg);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .stat-card {
            background: var(--bg-primary);
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: var(--space-md);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸŒ¸ ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ãƒãƒƒãƒ— ç®¡ç†ãƒ„ãƒ¼ãƒ«</h1>
            <p>åº—èˆ—æƒ…å ±ã‚’ç®¡ç†ã—ã¦ã€é«˜é€Ÿè¡¨ç¤ºç‰ˆHTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ</p>
        </div>

        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalStores">0</div>
                <div class="stat-label">ç·åº—èˆ—æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCategories">0</div>
                <div class="stat-label">ã‚«ãƒ†ã‚´ãƒªæ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="validCoordinates">0</div>
                <div class="stat-label">åº§æ¨™æœ‰åŠ¹</div>
            </div>
        </div>

        <!-- åº—èˆ—è¿½åŠ ãƒ»ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="section">
            <h2>åº—èˆ—æƒ…å ±å…¥åŠ›ãƒ»ç·¨é›†</h2>
            
            <form id="storeForm">
                <input type="hidden" id="storeId" value="">
                
                <!-- Googleãƒãƒƒãƒ—URLå…¥åŠ› -->
                <div class="form-group" style="border: 2px dashed var(--secondary); padding: var(--space-lg); border-radius: var(--radius-md); background: rgba(64, 224, 208, 0.05);">
                    <label for="googleMapsUrl">ğŸ—ºï¸ Googleãƒãƒƒãƒ—URLï¼ˆè‡ªå‹•å…¥åŠ›ç”¨ï¼‰</label>
                    <input type="url" id="googleMapsUrl" placeholder="https://maps.google.com/maps?q=... ã¾ãŸã¯ https://goo.gl/maps/..." style="border-color: var(--secondary);">
                    <small style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-top: var(--space-sm);">
                        ğŸ’¡ Googleãƒãƒƒãƒ—ã®URLã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã¨ã€åº—èˆ—åãƒ»ä½æ‰€ãƒ»åº§æ¨™ã‚’è‡ªå‹•ã§å…¥åŠ›ã—ã¾ã™
                    </small>
                    <button type="button" id="parseUrlBtn" class="btn btn-secondary" style="margin-top: var(--space-sm);">
                        ğŸ” URLè§£æãƒ»è‡ªå‹•å…¥åŠ›
                    </button>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="storeName">åº—èˆ—å *</label>
                        <input type="text" id="storeName" required>
                    </div>
                    <div class="form-group">
                        <label for="storeCategory">ã‚«ãƒ†ã‚´ãƒª *</label>
                        <select id="storeCategory" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="ã‚«ãƒ•ã‚§">â˜• ã‚«ãƒ•ã‚§</option>
                            <option value="å’Œé£Ÿ">ğŸ± å’Œé£Ÿ</option>
                            <option value="æ´‹é£Ÿ">ğŸ½ï¸ æ´‹é£Ÿ</option>
                            <option value="ãƒ‘ãƒ³å±‹">ğŸ¥ ãƒ‘ãƒ³å±‹</option>
                            <option value="ã‚¹ã‚¤ãƒ¼ãƒ„">ğŸ§ ã‚¹ã‚¤ãƒ¼ãƒ„</option>
                            <option value="è²©å£²åº—">ğŸ›’ è²©å£²åº—</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="storeAddress">ä½æ‰€ *</label>
                    <input type="text" id="storeAddress" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="storeLatitude">ç·¯åº¦</label>
                        <input type="number" id="storeLatitude" step="0.000001" placeholder="35.6762">
                    </div>
                    <div class="form-group">
                        <label for="storeLongitude">çµŒåº¦</label>
                        <input type="number" id="storeLongitude" step="0.000001" placeholder="139.6503">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="storePhone">é›»è©±ç•ªå·</label>
                        <input type="text" id="storePhone" placeholder="03-1234-5678">
                    </div>
                    <div class="form-group">
                        <label for="storeHours">å–¶æ¥­æ™‚é–“</label>
                        <input type="text" id="storeHours" placeholder="9:00-18:00">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="storeWebsite">ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</label>
                        <input type="url" id="storeWebsite" placeholder="https://example.com">
                    </div>
                    <div class="form-group">
                        <label for="storeGfOptions">ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼å¯¾å¿œ</label>
                        <select id="storeGfOptions">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="å®Œå…¨GF">å®Œå…¨GF</option>
                            <option value="éƒ¨åˆ†GF">éƒ¨åˆ†GF</option>
                            <option value="å¯¾å¿œå¯èƒ½">å¯¾å¿œå¯èƒ½</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="storeDescription">èª¬æ˜ãƒ»å‚™è€ƒ</label>
                    <textarea id="storeDescription" placeholder="åº—èˆ—ã®ç‰¹å¾´ã‚„æ³¨æ„äº‹é …ãªã©"></textarea>
                </div>

                <div style="text-align: center;">
                    <button type="submit" class="btn btn-primary">åº—èˆ—ã‚’è¿½åŠ </button>
                    <button type="button" class="btn btn-secondary" id="clearForm">ã‚¯ãƒªã‚¢</button>
                    <button type="button" class="btn btn-warning" id="geocodeBtn">ä½æ‰€ã‹ã‚‰åº§æ¨™ã‚’å–å¾—</button>
                </div>
            </form>
        </div>

        <!-- åº—èˆ—ä¸€è¦§ -->
        <div class="section">
            <h2>ç™»éŒ²æ¸ˆã¿åº—èˆ—ä¸€è¦§</h2>
            <div id="storeList" class="store-list">
                <!-- åº—èˆ—ãƒªã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
        <div class="section">
            <h2>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
            
            <div style="text-align: center; margin-bottom: var(--space-lg);">
                <button class="btn btn-secondary" id="loadFromSupabase">Supabaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—</button>
                <button class="btn btn-warning" id="importJson">JSONãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿</button>
                <button class="btn btn-success" id="exportJson">JSONãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›</button>
            </div>

            <input type="file" id="jsonFileInput" accept=".json" style="display: none;">
        </div>

        <!-- GitHub Pagesè¨­å®š -->
        <div class="section">
            <h2>âš™ï¸ GitHub Pagesè¨­å®š</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="githubToken">GitHub Personal Access Token *</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxx">
                    <small style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-top: var(--space-sm);">
                        ğŸ’¡ GitHub Settings > Developer settings > Personal access tokens ã§å–å¾—
                    </small>
                </div>
                <div class="form-group">
                    <label for="githubRepo">ãƒªãƒã‚¸ãƒˆãƒªå *</label>
                    <input type="text" id="githubRepo" placeholder="username/repository-name">
                    <small style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-top: var(--space-sm);">
                        ğŸ’¡ ä¾‹: kanakugimakoto/gluten-free-map
                    </small>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn btn-secondary" id="saveGithubSettings">è¨­å®šã‚’ä¿å­˜</button>
                <button class="btn btn-warning" id="testGithubConnection">æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>

        <!-- HTMLãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
        <div class="download-section">
            <h2>ğŸš€ HTMLãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ»å…¬é–‹</h2>
            <p>ç¾åœ¨ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã§åŸ‹ã‚è¾¼ã¿ç‰ˆHTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã€GitHub Pagesã§è‡ªå‹•å…¬é–‹ã—ã¾ã™</p>
            <div style="margin: var(--space-lg) 0;">
                <button class="btn btn-primary" id="generateHtml" style="font-size: 1.2rem; padding: var(--space-lg) var(--space-xl);">
                    ğŸ“„ åŸ‹ã‚è¾¼ã¿ç‰ˆHTMLã‚’ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </button>
                <button class="btn btn-success" id="deployToGithub" style="font-size: 1.2rem; padding: var(--space-lg) var(--space-xl); margin-left: var(--space-md);">
                    ğŸš€ GitHub Pagesã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
                </button>
            </div>
            <p style="font-size: 0.9rem; opacity: 0.9;">
                GitHub Pagesãƒ‡ãƒ—ãƒ­ã‚¤ã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆâ†’ãƒªãƒã‚¸ãƒˆãƒªãƒ—ãƒƒã‚·ãƒ¥â†’è‡ªå‹•å…¬é–‹ã¾ã§ä¸€æ‹¬å®Ÿè¡Œã•ã‚Œã¾ã™
            </p>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let stores = [];
        let editingStoreId = null;

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            console.log('ç®¡ç†ãƒ„ãƒ¼ãƒ«åˆæœŸåŒ–é–‹å§‹');
            
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ãƒ­ãƒ¼ãƒ‰
            loadSampleData();
            
            // GitHubè¨­å®šã‚’å¾©å…ƒ
            loadGithubSettings();
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupEventListeners();
            
            console.log('ç®¡ç†ãƒ„ãƒ¼ãƒ«åˆæœŸåŒ–å®Œäº†');
        }

        // Googleãƒãƒƒãƒ—URLè§£æ
        function parseGoogleMapsUrl(url) {
            try {
                // å„ç¨®Googleãƒãƒƒãƒ—URLå½¢å¼ã«å¯¾å¿œ
                const patterns = {
                    // æ¨™æº–æ¤œç´¢URL: https://www.google.com/maps/search/åº—èˆ—å
                    search: /google\.com\/maps\/search\/([^/?&]+)/,
                    // place URL: https://www.google.com/maps/place/åº—èˆ—å/
                    place: /google\.com\/maps\/place\/([^/?&@]+)/,
                    // åº§æ¨™ä»˜ãURL: https://www.google.com/maps/@35.1234,136.5678,15z
                    coords: /google\.com\/maps\/@(-?\d+\.\d+),(-?\d+\.\d+)/,
                    // query parameterå½¢å¼: ?q=åº—èˆ—å
                    query: /[?&]q=([^&]+)/,
                    // data parameterå½¢å¼: !3dç·¯åº¦!4dçµŒåº¦
                    data: /!3d(-?\d+\.\d+)!4d(-?\d+\.\d+)/
                };

                const result = {
                    name: '',
                    address: '',
                    latitude: null,
                    longitude: null
                };

                // åº—èˆ—åæŠ½å‡º
                if (patterns.place.test(url)) {
                    const match = url.match(patterns.place);
                    if (match) {
                        result.name = decodeURIComponent(match[1]).replace(/\+/g, ' ');
                    }
                } else if (patterns.search.test(url)) {
                    const match = url.match(patterns.search);
                    if (match) {
                        result.name = decodeURIComponent(match[1]).replace(/\+/g, ' ');
                    }
                } else if (patterns.query.test(url)) {
                    const match = url.match(patterns.query);
                    if (match) {
                        result.name = decodeURIComponent(match[1]).replace(/\+/g, ' ');
                    }
                }

                // åº§æ¨™æŠ½å‡º
                if (patterns.coords.test(url)) {
                    const match = url.match(patterns.coords);
                    if (match) {
                        result.latitude = parseFloat(match[1]);
                        result.longitude = parseFloat(match[2]);
                    }
                } else if (patterns.data.test(url)) {
                    const match = url.match(patterns.data);
                    if (match) {
                        result.latitude = parseFloat(match[1]);
                        result.longitude = parseFloat(match[2]);
                    }
                }

                // ä½æ‰€ã¯åº—èˆ—åã‹ã‚‰æ¨æ¸¬ï¼ˆç°¡æ˜“ç‰ˆï¼‰
                if (result.name && !result.address) {
                    // åº—èˆ—åã‹ã‚‰ä½æ‰€ã£ã½ã„éƒ¨åˆ†ã‚’æŠ½å‡º
                    const addressPatterns = [
                        /([éƒ½é“åºœçœŒå¸‚åŒºç”ºæ‘].+)/,
                        /(\d+[ä¸ç›®ç•ªå·å·-]+.*)/
                    ];
                    
                    for (const pattern of addressPatterns) {
                        const match = result.name.match(pattern);
                        if (match) {
                            result.address = match[1];
                            break;
                        }
                    }
                }

                return result;
            } catch (error) {
                console.error('URLè§£æã‚¨ãƒ©ãƒ¼:', error);
                return null;
            }
        }

        // Googleãƒãƒƒãƒ—URLè§£æãƒœã‚¿ãƒ³å‡¦ç†
        function handleUrlParse() {
            const url = document.getElementById('googleMapsUrl').value.trim();
            if (!url) {
                showAlert('Googleãƒãƒƒãƒ—URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            const parsed = parseGoogleMapsUrl(url);
            if (!parsed) {
                showAlert('URLã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                return;
            }

            // ãƒ•ã‚©ãƒ¼ãƒ ã«è‡ªå‹•å…¥åŠ›
            if (parsed.name) {
                document.getElementById('storeName').value = parsed.name;
            }
            if (parsed.address) {
                document.getElementById('storeAddress').value = parsed.address;
            }
            if (parsed.latitude && parsed.longitude) {
                document.getElementById('storeLatitude').value = parsed.latitude;
                document.getElementById('storeLongitude').value = parsed.longitude;
            }

            // çµæœã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤º
            let message = 'URLè§£æçµæœ:\n';
            if (parsed.name) message += `åº—èˆ—å: ${parsed.name}\n`;
            if (parsed.address) message += `ä½æ‰€: ${parsed.address}\n`;
            if (parsed.latitude && parsed.longitude) {
                message += `åº§æ¨™: ${parsed.latitude}, ${parsed.longitude}\n`;
            } else {
                message += 'åº§æ¨™: å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ\n';
            }

            showAlert('URLè§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ•ã‚©ãƒ¼ãƒ ã«è‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã—ãŸã€‚', 'success');
            console.log(message);
        }

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadSampleData() {
            stores = [
                {
                    id: 1,
                    name: 'ã¿ã¡ã®ã‚Šå¼å½“ï¼ˆGluten-Free Michinori Bentoï¼‰',
                    category: 'å’Œé£Ÿ',
                    address: 'åå¤å±‹å¸‚è¥¿åŒºæµ„å¿ƒï¼‘ä¸ç›®ï¼”âˆ’ï¼–',
                    latitude: 35.1938,
                    longitude: 136.8901,
                    gluten_free_options: 'å®Œå…¨GF',
                    opening_hours: '11æ™‚00åˆ†ï½19æ™‚00åˆ†',
                    phone: '052-5086-615',
                    website: 'https://gf-michinori.jp/',
                    description: 'ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ã®ãŠå¼å½“å°‚é–€åº—ã§ã™ã€‚ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã®ã¿ã§ã”æä¾›ã—ã¦ãŠã‚Šã¾ã™'
                },
                {
                    id: 2,
                    name: 'Biople åå¤å±‹ã‚¿ã‚«ã‚·ãƒãƒ¤ã‚²ãƒ¼ãƒˆã‚¿ãƒ¯ãƒ¼ãƒ¢ãƒ¼ãƒ«åº—',
                    category: 'è²©å£²åº—',
                    address: 'åå¤å±‹å¸‚ä¸­æ‘åŒºåé§…ï¼‘ä¸ç›®ï¼‘âˆ’ï¼“ JRã‚²ãƒ¼ãƒˆã‚¿ãƒ¯ãƒ¼ ã‚¿ã‚«ã‚·ãƒãƒ¤ ãƒ¢ãƒ¼ãƒ« B1F',
                    latitude: 35.1722,
                    longitude: 136.882,
                    gluten_free_options: 'éƒ¨åˆ†GF',
                    opening_hours: '9æ™‚00åˆ†ï½21æ™‚00åˆ†',
                    phone: '052-5666-112',
                    website: 'https://store.biople.jp/',
                    description: 'ãƒŠãƒãƒ¥ãƒ©ãƒ«ï¼†ã‚ªãƒ¼ã‚¬ãƒ‹ãƒƒã‚¯ã®ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã‚’å¹…åºƒãå–ã‚Šæ‰±ã†ã‚»ãƒ¬ã‚¯ãƒˆã‚·ãƒ§ãƒƒãƒ—ã§ã™ã€‚'
                }
            ];
            
            updateStoreList();
            updateStats();
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
            document.getElementById('storeForm').addEventListener('submit', handleFormSubmit);
            
            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('clearForm').addEventListener('click', clearForm);
            document.getElementById('parseUrlBtn').addEventListener('click', handleUrlParse);
            document.getElementById('geocodeBtn').addEventListener('click', geocodeAddress);
            document.getElementById('loadFromSupabase').addEventListener('click', loadFromSupabase);
            document.getElementById('generateHtml').addEventListener('click', generateHtmlFile);
            document.getElementById('deployToGithub').addEventListener('click', deployToGithubPages);
            document.getElementById('saveGithubSettings').addEventListener('click', saveGithubSettings);
            document.getElementById('testGithubConnection').addEventListener('click', testGithubConnection);
            document.getElementById('exportJson').addEventListener('click', exportJsonFile);
            document.getElementById('importJson').addEventListener('click', () => {
                document.getElementById('jsonFileInput').click();
            });
            
            // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
            document.getElementById('jsonFileInput').addEventListener('change', handleJsonImport);
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        function handleFormSubmit(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('storeName').value,
                category: document.getElementById('storeCategory').value,
                address: document.getElementById('storeAddress').value,
                latitude: parseFloat(document.getElementById('storeLatitude').value) || null,
                longitude: parseFloat(document.getElementById('storeLongitude').value) || null,
                phone: document.getElementById('storePhone').value,
                opening_hours: document.getElementById('storeHours').value,
                website: document.getElementById('storeWebsite').value,
                gluten_free_options: document.getElementById('storeGfOptions').value,
                description: document.getElementById('storeDescription').value
            };

            if (editingStoreId) {
                // ç·¨é›†
                const index = stores.findIndex(s => s.id === editingStoreId);
                if (index !== -1) {
                    stores[index] = { ...formData, id: editingStoreId };
                    editingStoreId = null;
                    document.querySelector('button[type="submit"]').textContent = 'åº—èˆ—ã‚’è¿½åŠ ';
                }
            } else {
                // æ–°è¦è¿½åŠ 
                const newId = Math.max(...stores.map(s => s.id), 0) + 1;
                stores.push({ ...formData, id: newId });
            }

            updateStoreList();
            updateStats();
            clearForm();
            
            showAlert('åº—èˆ—æƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        function clearForm() {
            document.getElementById('storeForm').reset();
            document.getElementById('storeId').value = '';
            editingStoreId = null;
            document.querySelector('button[type="submit"]').textContent = 'åº—èˆ—ã‚’è¿½åŠ ';
        }

        // åº—èˆ—ç·¨é›†
        function editStore(id) {
            const store = stores.find(s => s.id === id);
            if (!store) return;

            editingStoreId = id;
            
            document.getElementById('storeName').value = store.name || '';
            document.getElementById('storeCategory').value = store.category || '';
            document.getElementById('storeAddress').value = store.address || '';
            document.getElementById('storeLatitude').value = store.latitude || '';
            document.getElementById('storeLongitude').value = store.longitude || '';
            document.getElementById('storePhone').value = store.phone || '';
            document.getElementById('storeHours').value = store.opening_hours || '';
            document.getElementById('storeWebsite').value = store.website || '';
            document.getElementById('storeGfOptions').value = store.gluten_free_options || '';
            document.getElementById('storeDescription').value = store.description || '';
            
            document.querySelector('button[type="submit"]').textContent = 'åº—èˆ—ã‚’æ›´æ–°';
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.querySelector('.section').scrollIntoView({ behavior: 'smooth' });
        }

        // åº—èˆ—å‰Šé™¤
        function deleteStore(id) {
            if (confirm('ã“ã®åº—èˆ—ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                stores = stores.filter(s => s.id !== id);
                updateStoreList();
                updateStats();
                showAlert('åº—èˆ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'warning');
            }
        }

        // åº—èˆ—ä¸€è¦§æ›´æ–°
        function updateStoreList() {
            const container = document.getElementById('storeList');
            
            if (stores.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ç™»éŒ²æ¸ˆã¿åº—èˆ—ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            container.innerHTML = stores.map(store => `
                <div class="store-item">
                    <h4>${store.name}</h4>
                    <p><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> ${store.category}</p>
                    <p><strong>ä½æ‰€:</strong> ${store.address}</p>
                    ${store.latitude && store.longitude ? 
                        `<p><strong>åº§æ¨™:</strong> ${store.latitude}, ${store.longitude}</p>` : 
                        '<p style="color: #f59e0b;"><strong>åº§æ¨™:</strong> æœªè¨­å®š</p>'
                    }
                    <div class="store-actions">
                        <button class="btn btn-primary" onclick="editStore(${store.id})">ç·¨é›†</button>
                        <button class="btn btn-warning" onclick="deleteStore(${store.id})">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            document.getElementById('totalStores').textContent = stores.length;
            
            const categories = [...new Set(stores.map(s => s.category).filter(Boolean))];
            document.getElementById('totalCategories').textContent = categories.length;
            
            const validCoords = stores.filter(s => s.latitude && s.longitude).length;
            document.getElementById('validCoordinates').textContent = validCoords;
        }

        // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
        function showAlert(message, type = 'success') {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.querySelector('.container').insertBefore(alert, document.querySelector('.section'));
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // Supabaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
        async function loadFromSupabase() {
            try {
                showAlert('Supabaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...', 'warning');
                
                // Supabaseè¨­å®šï¼ˆindex-final.htmlã‹ã‚‰ï¼‰
                const SUPABASE_URL = 'https://hxrmsjfvgctoaxpbukvo.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh4cm1zamZ2Z2N0b2F4cGJ1a3ZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5MTI3NTAsImV4cCI6MjA3MDQ4ODc1MH0.tM1vDVVhYhh7OHlA1BTj071BfsIzeBG_HatijjtxwLw';
                
                // ç›´æ¥fetch APIã§ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆRLSç„¡åŠ¹ã®ãŸã‚ï¼‰
                const storesResponse = await fetch(`${SUPABASE_URL}/rest/v1/stores?select=*,store_categories(name,icon)`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!storesResponse.ok) {
                    throw new Error(`HTTP error! status: ${storesResponse.status}`);
                }

                const storesData = await storesResponse.json();
                console.log('å–å¾—ã—ãŸåº—èˆ—ãƒ‡ãƒ¼ã‚¿:', storesData);

                if (storesData && storesData.length > 0) {
                    // Supabaseãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ãƒ„ãƒ¼ãƒ«å½¢å¼ã«å¤‰æ›
                    stores = storesData.map(store => ({
                        id: store.id,
                        name: store.name,
                        category: store.store_categories ? store.store_categories.name : store.category_id,
                        address: store.address,
                        latitude: store.latitude,
                        longitude: store.longitude,
                        phone: store.phone,
                        opening_hours: store.opening_hours,
                        website: store.website,
                        gluten_free_options: store.gluten_free_options,
                        description: store.description
                    }));

                    updateStoreList();
                    updateStats();
                    showAlert(`${stores.length}ä»¶ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’Supabaseã‹ã‚‰å–å¾—ã—ã¾ã—ãŸ`, 'success');
                } else {
                    showAlert('Supabaseã‹ã‚‰åº—èˆ—ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'warning');
                }
            } catch (error) {
                console.error('Supabaseãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                showAlert(`ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ä½æ‰€ã‹ã‚‰åº§æ¨™å–å¾—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        function geocodeAddress() {
            const address = document.getElementById('storeAddress').value;
            if (!address) {
                alert('ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            showAlert('åº§æ¨™å–å¾—æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ã€‚æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'warning');
        }

        // JSONãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
        function exportJsonFile() {
            const data = {
                stores: stores,
                exportDate: new Date().toISOString(),
                totalStores: stores.length
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `gluten-free-stores-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showAlert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
        }

        // JSONãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
        function handleJsonImport(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.stores && Array.isArray(data.stores)) {
                        stores = data.stores;
                        updateStoreList();
                        updateStats();
                        showAlert(`${stores.length}ä»¶ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'success');
                    } else {
                        throw new Error('ä¸æ­£ãªJSONãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™');
                    }
                } catch (error) {
                    alert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // HTMLãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
        function generateHtmlFile() {
            if (stores.length === 0) {
                alert('åº—èˆ—ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            const htmlTemplate = generateEmbeddedHtmlTemplate(stores);
            
            const blob = new Blob([htmlTemplate], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `gluten-free-map-${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            
            URL.revokeObjectURL(url);
            showAlert(`${stores.length}åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ã§åŸ‹ã‚è¾¼ã¿ç‰ˆHTMLã‚’ç”Ÿæˆã—ã¾ã—ãŸ`, 'success');
        }

        // åŸ‹ã‚è¾¼ã¿ç‰ˆHTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
        function generateEmbeddedHtmlTemplate(storesData) {
            const storesJson = JSON.stringify(storesData, null, 12);
            const generationDate = new Date().toISOString();
            
            return `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ãƒãƒƒãƒ— | ãƒ“ãƒ¨ãƒ•ãƒªå€¶æ¥½éƒ¨</title>
    
    <!-- ã‚¢ã‚¤ã‚³ãƒ³è¨­å®š -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%23ff6b9d'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-size='24' fill='white'%3EğŸŒ¸%3C/text%3E%3C/svg%3E">
    
    <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- ã‚¹ã‚¿ã‚¤ãƒ«ã¯çœç•¥ï¼ˆå®Ÿéš›ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯å®Œå…¨ãªCSSã‚’å«ã‚€ï¼‰ -->
    <style>
        /* å®Œå…¨ãªCSSã‚¹ã‚¿ã‚¤ãƒ«ãŒã“ã“ã«å…¥ã‚‹ */
        /* çœç•¥è¡¨ç¤ºã®ãŸã‚ã€å®Ÿéš›ã¯ index-embedded.html ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ« */
    </style>
</head>
<body>
    <!-- HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯çœç•¥ï¼ˆå®Ÿéš›ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯å®Œå…¨ãªHTMLã‚’å«ã‚€ï¼‰ -->
    <!-- çœç•¥è¡¨ç¤ºã®ãŸã‚ã€å®Ÿéš›ã¯ index-embedded.html ã¨åŒã˜HTMLæ§‹é€  -->
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"><\\/script>
    <script>
        // ğŸš€ è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸåŸ‹ã‚è¾¼ã¿åº—èˆ—ãƒ‡ãƒ¼ã‚¿
        const embeddedStores = ` + storesJson + `;
        
        // ç®¡ç†ãƒ„ãƒ¼ãƒ«ç”Ÿæˆæƒ…å ±
        console.log('ğŸ”§ ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ç”Ÿæˆã•ã‚ŒãŸHTML');
        console.log('ğŸ“… ç”Ÿæˆæ—¥æ™‚:', '` + generationDate + `');
        console.log('ğŸ“Š åº—èˆ—æ•°:', ` + storesData.length + `);
        
        // ä»¥ä¸‹ã€å®Œå…¨ãªJavaScriptã‚³ãƒ¼ãƒ‰ãŒç¶šã
        // ï¼ˆå®Ÿéš›ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯ index-embedded.html ã¨åŒã˜JSã‚³ãƒ¼ãƒ‰ï¼‰
    <\\/script>
</body>
</html>`;
        }

        // GitHub Pagesè¨­å®šç®¡ç†
        function loadGithubSettings() {
            const token = localStorage.getItem('github_token');
            const repo = localStorage.getItem('github_repo');
            
            if (token) document.getElementById('githubToken').value = token;
            if (repo) document.getElementById('githubRepo').value = repo;
        }

        function saveGithubSettings() {
            const token = document.getElementById('githubToken').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            
            if (!token || !repo) {
                showAlert('GitHub Tokenã¨Repositoryåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            localStorage.setItem('github_token', token);
            localStorage.setItem('github_repo', repo);
            
            showAlert('GitHubè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
        }

        // GitHubæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function testGithubConnection() {
            const token = document.getElementById('githubToken').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            
            if (!token || !repo) {
                showAlert('GitHub Tokenã¨Repositoryåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            try {
                showAlert('GitHubæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆä¸­...', 'warning');
                
                const response = await fetch(`https://api.github.com/repos/${repo}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const repoData = await response.json();
                    showAlert(`GitHubæ¥ç¶šæˆåŠŸ: ${repoData.full_name}`, 'success');
                } else if (response.status === 401) {
                    showAlert('GitHub TokenãŒç„¡åŠ¹ã§ã™', 'error');
                } else if (response.status === 404) {
                    showAlert('ãƒªãƒã‚¸ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                } else {
                    showAlert(`GitHubæ¥ç¶šã‚¨ãƒ©ãƒ¼: ${response.status}`, 'error');
                }
            } catch (error) {
                console.error('GitHubæ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                showAlert(`æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // GitHub Pagesã¸ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
        async function deployToGithubPages() {
            const token = localStorage.getItem('github_token');
            const repo = localStorage.getItem('github_repo');
            
            if (!token || !repo) {
                showAlert('GitHubè¨­å®šã‚’å…ˆã«ä¿å­˜ã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            if (stores.length === 0) {
                showAlert('åº—èˆ—ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
                return;
            }

            try {
                showAlert('GitHub Pagesã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­...', 'warning');
                
                // 1. HTMLãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
                const htmlContent = generateEmbeddedHtmlTemplate(stores);
                
                // 2. GitHub APIã§ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°/ä½œæˆ
                const fileName = 'index.html';
                const message = `ğŸš€ ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ãƒãƒƒãƒ—æ›´æ–° (${stores.length}åº—èˆ—) - ${new Date().toISOString().split('T')[0]}`;
                
                // æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®SHAå–å¾—ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
                let sha = null;
                try {
                    const existingResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${fileName}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (existingResponse.ok) {
                        const existingData = await existingResponse.json();
                        sha = existingData.sha;
                    }
                } catch (error) {
                    console.log('æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ');
                }

                // ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°/ä½œæˆ
                const updateData = {
                    message: message,
                    content: btoa(unescape(encodeURIComponent(htmlContent))), // UTF-8 Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
                    branch: 'main'
                };
                
                if (sha) {
                    updateData.sha = sha;
                }

                const updateResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                if (updateResponse.ok) {
                    const result = await updateResponse.json();
                    const pagesUrl = `https://${repo.split('/')[0]}.github.io/${repo.split('/')[1]}`;
                    
                    showAlert(`ğŸ‰ GitHub Pagesãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸ! æ•°åˆ†å¾Œã« ${pagesUrl} ã§ç¢ºèªã§ãã¾ã™`, 'success');
                    console.log('GitHub Pages URL:', pagesUrl);
                    console.log('Commit URL:', result.commit.html_url);
                } else {
                    const errorData = await updateResponse.json();
                    throw new Error(`GitHub API Error: ${errorData.message}`);
                }
                
            } catch (error) {
                console.error('GitHub Pagesãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼:', error);
                showAlert(`ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // å®Œå…¨ãªåŸ‹ã‚è¾¼ã¿ç‰ˆHTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆï¼ˆå®Ÿéš›ã®index-embedded.htmlãƒ™ãƒ¼ã‚¹ï¼‰
        function generateCompleteEmbeddedHtml(storesData) {
            // index-embedded.htmlã®å®Œå…¨ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ
            // ã“ã“ã§ã¯ç°¡ç•¥ç‰ˆã‚’è¿”ã™ãŒã€å®Ÿéš›ã¯å®Œå…¨ãªHTMLã‚’ç”Ÿæˆã™ã‚‹
            return generateEmbeddedHtmlTemplate(storesData);
        }

        // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        console.log('ğŸŒ¸ ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ãƒãƒƒãƒ—ç®¡ç†ãƒ„ãƒ¼ãƒ«');
        console.log('ğŸ“Š æ©Ÿèƒ½: åº—èˆ—ç®¡ç†ã€HTMLãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã€GitHub Pagesè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤');
    </script>
</body>
</html>